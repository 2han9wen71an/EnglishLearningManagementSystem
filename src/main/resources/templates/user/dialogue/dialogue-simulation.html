<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>情景对话模拟</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css">
    <link rel="stylesheet" th:href="@{/static/css/cs-skin-elastic.css}">
    <link rel="stylesheet" th:href="@{/static/css/style.css}">

    <link href="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jqvmap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/weathericons@2.1.0/css/weather-icons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.css" rel="stylesheet" />

    <style>
        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 75%;
            position: relative;
        }
        .ai-message {
            background-color: #e9ecef;
            float: left;
            clear: both;
        }
        .user-message {
            background-color: #007bff;
            color: white;
            float: right;
            clear: both;
        }
        .prompt-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }
        .input-area {
            display: flex;
            margin-top: 15px;
        }
        .input-area textarea {
            flex-grow: 1;
            border-radius: 20px;
            padding: 10px 15px;
            margin-right: 10px;
            resize: none;
        }
        .voice-btn {
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        .send-btn {
            border-radius: 20px;
            padding: 10px 20px;
        }
        .clearfix {
            clear: both;
        }
    </style>
</head>

<body>

<!-- Left Panel -->
<div th:replace="common/leftbar::leftbar"/>

<!-- Right Panel -->
<div id="right-panel" class="right-panel">
    <!-- Header-->
    <div th:replace="common/header::header"/>
    <!-- /#header -->

    <!-- Content -->
    <div class="content">
        <div class="animated fadeIn">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header">
                            <strong class="card-title" th:text="${scenario.scenarioName}">场景名称</strong>
                            <a th:href="@{/viewDialogueScenarios}" class="btn btn-sm btn-outline-secondary float-right">返回场景列表</a>
                        </div>
                        <div class="card-body">
                            <p th:text="${scenario.scenarioDescription}">场景描述</p>

                            <!-- 对话区域 -->
                            <input type="hidden" id="scenarioId" th:value="${scenario.scenarioId}">
                            <div class="chat-container" id="chatContainer">
                                <!-- 初始AI消息 -->
                                <div class="message ai-message" th:if="${dialogueContents != null && !dialogueContents.isEmpty()}">
                                    <span th:text="${dialogueContents[0].content}">AI初始消息</span>
                                    <div class="clearfix"></div>
                                </div>
                            </div>

                            <!-- 提示区域 -->
                            <div class="prompt-box" id="promptBox" th:if="${dialogueContents != null && dialogueContents.size() > 1}">
                                <strong>提示：</strong> <span id="currentPrompt" th:text="${dialogueContents[1].prompt}">当前提示</span>
                            </div>

                            <!-- 输入区域 -->
                            <div class="input-area">
                                <button class="btn btn-danger voice-btn" id="voiceBtn" title="语音输入">
                                    <i class="fa fa-microphone"></i>
                                </button>
                                <textarea class="form-control" id="userInput" rows="2" placeholder="输入您的回复..."></textarea>
                                <button class="btn btn-primary send-btn" id="sendBtn">发送</button>
                            </div>

                            <!-- 控制按钮 -->
                            <div class="mt-3">
                                <button class="btn btn-outline-secondary" id="resetBtn">重新开始</button>
                                <button class="btn btn-outline-primary ml-2" id="toggleAiModeBtn">切换AI模式</button>
                                <span class="badge badge-info ml-2" id="aiModeIndicator">AI模式: 开启</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.content -->

    <div class="clearfix"></div>
    <!-- Footer -->
    <div th:replace="common/footer::footer"/>
    <!-- /.site-footer -->
</div>

<!-- Scripts -->
<!-- 使用与项目其他部分相同的脚本引用，保持一致性 -->
<script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
<script th:src="@{/static/js/main.js}"></script>

<!-- 对话模拟脚本 -->
<script th:src="@{/static/js/dialogue.js}"></script>

</body>
</html>
